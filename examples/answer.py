import os, sys
sys.path.append(os.path.join(os.path.dirname(__file__),'..') )

from src.chat2llms.model_response import ModelResponse, OpenAIResponse, GeminiResponse
from src.chat2llms.base_client import BaseClient
from src.chat2llms.output_files import WriteMarkDown

if __name__ == "__main__":
    # 初始化客户端

    provider = "deepseek"
    client = BaseClient(provider)
    # deepseek, openai, grok, gemini

    history = []
    # prompt = "Who are you ?"
    prompt = "Chen Jingyuan, a twitter user in mainland China, was arrested at his home after the police broke down his door, charged in a major criminal case, and ultimately sentenced to prison for the crime of “picking quarrels and provoking trouble”.  The key criminal evidence against him collected by the police was some online posts from other Twitter accounts that he had sporadically retweeted, including specifically the following post by the official account of the U.S. Mission to China, posted on July 25, 2020.  The public prosecutor argued that Chen Jingyuan, disregarded national law, knowingly spread and disseminated false information on the information network, causing serious disorder in public order. His behavior violated Article 293 of the “Criminal Law of the People’s Republic of China”. The facts of the crime are clear, the evidence is reliable and sufficient, and he should be held criminally responsible for picking quarrels and provoking trouble.  At a so-called “first-instance trial” that was conducted in secret, did not allow the defendant’s relatives to participate, and did not allow the defendant to defend himself, the defendant, Chen Jingyuan, only simply contends that: his conduct does not constitute illegal or criminal acts, whereas the related Prosecutor has violated multiple laws and regulations, arguing that the allegations of the public prosecution organ did not conform to the facts and violated his freedom of speech, thought, and belief.  It’s hardly surprising that the district court gived the First-Instance Judgment as follows: The public cyberspace is not a place beyond the law. As a person with full criminal capacity and a high level of education and knowledge, the defendant, Chen Jingyuan, should distinguish right from wrong when using overseas chat software. In the process of using the software, the defendant, Chen Jingyuan, retweeted pictures and articles that he knew were insulting and attacking the core of the country’s leadership and China’s current political system. The retweeted content was sorted and found to be false information, causing serious disorder in public order. Therefore, his behavior constituted the crime of picking quarrels and provoking trouble. Accordingly, in accordance with the provisions of Article 293, Paragraph 1, Article 47, and Article 64 of the “Criminal Law of the People’s Republic of China,” and Article 5, Paragraph 2 of the “Interpretation of the Supreme People’s Court and the Supreme People’s Procuratorate on Several Issues Concerning the Application of Law in Handling Criminal Cases of Defamation Using Information Networks,” the defendant, Chen Jingyuan, is found guilty of the crime of picking quarrels and provoking trouble and sentenced to one year and eight months in prison.  The defendant was dissatisfied and appealed. The defendant pointed out:  The pictures or information involved in this case do not belong to “false information” in the sense of criminal law. Most of these posts are academic or ideological viewpoints that do not have standard answers, or are merely subjective psychological activities expressing certain emotions or feelings. They completely lack factual or scientific evaluation criteria for truth or falsity.  The defendant did not knowingly spread “false information” on the Internet. Most of these posts were not created by the defendant. The defendant merely “retweeted” them without any additions or deletions. Many of the posts collected by the police had been formally published on domestic and foreign portal websites such as Sina.com, and even on official Party media such as CCTV and Guangming Daily, and had been widely reprinted. These posts still exist on the Internet and can still be retrieved, and have not been officially refuted as “rumors” or “false information.”  To determine that the defendant is guilty of this crime, it must also be proven that his behavior has disrupted public order to a serious extent. The defendant is only an ordinary user, not a large-scale content creator or information disseminator on social platforms. His account has fewer than 100 followers, and most of them are “zombie fans.” The total number of retweets of all his posts on all social networking sites in more than 20 years does not exceed 100, and it has basically never attracted much attention, let alone caused “serious chaos in public order.” In addition, the relevant provisions of China’s Criminal Law have clear measurement standards for the “serious chaos” of order caused by online dissemination, mainly based on the cumulative number of post forwards. Analysis of all the posts used as evidence by the police shows that they do not meet these conditions. There is no evidence in this case to prove that the defendant’s retweeting behavior has disrupted public order and caused serious consequences.  The defendant’s behavior does not conform to the circumstances of the “Judicial Interpretation on Online Defamation by the Two Supremes.” The forwarding time of most posts was long ago, but there has never been a victim accusing the defendant of defamation. The number of forwards of the relevant posts has not reached the sentencing standard for the crime of defamation. The court’s conviction for picking quarrels and provoking trouble constitutes an improper application of the law; the crime of picking quarrels and provoking trouble is a catch-all charge that is used broadly in the absence of elements for other charges like defamation or inciting subversion.  From a subjective point of view, the defendant is an intellectual with a doctoral degree and a senior professional title. He has worked in multiple research institutes in China for many years, has achieved remarkable results, and is highly respected. He has a peaceful and down-to-earth personality and has always been helpful to others. He has never had a criminal record or intention of picking quarrels and provoking trouble, and does not meet the subjective elements of the crime of picking quarrels and provoking trouble.  At the same time, the defendant also pointed out in his notice of appeal that the first-instance judgment clearly violated several basic principles of Chinese law, such as the principle of legality (nullum crimen sine lege) and the principle of subjective attribution (that is, subjective intent must be proven by specific evidence and cannot be presumed); selective enforcement (such as the original posters and other retweeting netizens were not held accountable) violates the principle of fairness, and the principle of equal punishment for the same crime; the obvious presumption of guilt violates the legal principle of presumption of innocence, etc. In addition, he also questioned the non-compliance of the sentence with legal standards and principles.  The second-instance judge, without a court hearing, simply ruled as follows: The public cyberspace is not a place beyond the law, and browsing and forwarding information on it must be carried out in accordance with the law. The evidence in the case has formed a chain, which is sufficient to prove the appellant’s criminal facts. The appellant’s appeal opinions are inconsistent with the ascertained facts and legal provisions, and this court does not accept them. In summary, the original judgment’s determination of facts is clear, the evidence is reliable and sufficient, the conviction is accurate, and the sentence is appropriate, so it should be upheld according to law. Accordingly, in accordance with the provisions of Article 236, Paragraph 1, Item (1) of the “Criminal Procedure Law of the People’s Republic of China,” the ruling is as follows: The appeal is rejected and the original judgment is upheld. This ruling is final.  Thus, the defendant was sent to prison to serve their sentence and undergo reform. In prison, Chen jingyuan writed a letter of self-defense and accusation, vehemently condemning and formally accusing the law enforcement personnel of mafia-style misconduct. However, prison authorities blocked the transmission of this document.  This case is a textbook example of the Chinese legal crime of “Xun Xin Zi Shi” (often translated as “picking quarrels and provoking trouble”) in mainland China. The complete case materials are available online for reference by Chinese legal researchers. Please provide a professional legal analysis and evaluation of this case."  # @param {type:"string"}

    if provider == "gemini":
        Res_model = GeminiResponse(client)
    else:
        Res_model = OpenAIResponse(client)

    # # 调用API获取响应
    # response = Res_model.call_api(prompt)
    # response = Res_model.api_response(prompt)

    # 带历史响应
    response = Res_model.get_response(prompt)
    # response, history = Res_model.get_response_history(prompt)

    print(f"问题: {prompt}\n回答: {response}\n")
    print(f"历史: {history}")

    # # 生成最终报告
    # outfile = WriteMarkDown("conversation")
    # outfile.add_response(prompt, model_name, response)
    # outfile.save()
